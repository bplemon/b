<html>
  <head>
    <title>Fake Cloud Commerce Site</title>	
    <script type="text/javascript">
			window.OracleUnifiedVisit =
			{
				accountId: '0000000000001',
				host: 'https://cloud-commerce-visit.oracleoutsourcing.com',
				handle: function()
				{
					window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
				}
			};
		</script>
		
		<script type='text/javascript' src="https://cloud-commerce-visit.oracleoutsourcing.com/Visit/js/oracleunifiedvisit.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="https://ccexperimentsstatic.oracleoutsourcing.com/js/atgsvcs.js"></script>
		<link href="style.css" rel="stylesheet" />
		
		<script>
		
			function getSearchHistory(visitorIdKey) {
			  return localStorage.getItem('searchHistory_' + visitorIdKey);
			}
	
			function setVisitorIdText(text) {
				$('#visitor-id').text(text);
			}
			
			function setSearchHistoryTitle(isHistory) {
				var hasHistoryTitle = 'Your current search history',
					  noHistoryTitle = 'You have no search history';
						
		    $('#search-history-title').text(isHistory ? hasHistoryTitle : noHistoryTitle);
			}
			
		  function addSearchItem() {
				var visitorIdKey = localStorage.visitorId, searchValue = $('#search-value').val();

				if(searchValue == '')
					return;
				
				if(visitorIdKey == null) {
				  window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
					visitorIdKey = localStorage.visitorId
					setVisitorIdText(visitorIdKey);
				}

				lsSerchHistory = localStorage.getItem('searchHistory_' + visitorIdKey);
				
				if(lsSerchHistory == null || lsSerchHistory == '') {
					lsSerchHistory = searchValue;
				} else {
					lsSerchHistory = lsSerchHistory + ',' + searchValue;
				}
				
				localStorage.setItem('searchHistory_' + visitorIdKey, lsSerchHistory);	
				
				$('ul.search-history').append('<li>' + searchValue + '</li>');
				
				$('#search-value').val('');
				
				setSearchHistoryTitle(true);	
			}
			
			function clearLSSearchHistory() {
			  var visitorIdKey = localStorage.visitorId;
				if(visitorIdKey != null) {
				  localStorage.removeItem('searchHistory_' + visitorIdKey);
				}
				setSearchHistoryTitle(false);
				$('ul.search-history').empty();;
			}
			
			function clearLsVisitorId() {
			  localStorage.clear();
				setVisitorIdText('not set');
				setSearchHistoryTitle('No search history');	
			}
			
			$(document).ready(function(){
				var visitorIdKey = localStorage.visitorId, searchHistory, searchHistoryItems, searchHistoryTitle;

				if(visitorIdKey == null) {
				  window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
					visitorIdKey = localStorage.visitorId;
				}
				
				setVisitorIdText(visitorIdKey);
								
			  searchHistory = getSearchHistory(visitorIdKey);
				
				if(searchHistory != null && searchHistory != '') {
					searchHistoryItems = searchHistory.split(",");
					searchHistoryItems.forEach(function(item){
						$('ul.search-history').append('<li>' + item + '</li>');		
					});
					isSearchHistory = true;
				} else {
					isSearchHistory = false;
				}

				setSearchHistoryTitle(isSearchHistory);	
      });
		</script>
  </head>

  <body>
	  <div class="header">
			<a class="brand">
				<img src="oracle_logo.svg">
				<span>Fake Commerce Cloud Site</span>
			</a>
		</div>

	  <div class="visitor-id-panel">
		  <p>VisitorId: <span class="strong" id="visitor-id">not set</span></p>
		</div>
		
		<hr />
		
		<div class="search-panel">
      <p>
			  <input id="search-value" type="text" placeholder="Search..."></input>
			  <button type="button" onclick="addSearchItem()">Search</button>
		  </p>
		</div>
		
		<div class="tiles">
		
		</div>
		
		<hr />
		<div class="search-history">
		  <h4 id="search-history-title"></h4>
		  <ul class="search-history"></ul>
		  <br />
		  <hr />
		  <p>
		    <button type="button" onclick="clearLSSearchHistory()">Clear Search History</button>
		    <button type="button" onclick="clearLsVisitorId()">Clear Visitor ID</button>
	    </p>
		</div>

  <body>
</html>
