<html>
  <head>
    <title>Fake Cloud Commerce Site</title>	
    <script type="text/javascript">
			window.OracleUnifiedVisit =
			{
				accountId: '0000000000001',
				host: 'https://cloud-commerce-visit.oracleoutsourcing.com',
				handle: function()
				{
					window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
				}
			};
		</script>
		
		<script type='text/javascript' src="https://cloud-commerce-visit.oracleoutsourcing.com/Visit/js/oracleunifiedvisit.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="https://ccexperimentsstatic.oracleoutsourcing.com/js/atgsvcs.js"></script>
		<link href="style.css" rel="stylesheet" />
		
		<script>
		
			function getSearchHistory(visitorIdKey) {
			  return localStorage.getItem('searchHistory_' + visitorIdKey);
			}
			
			function getCartContents(visitorIdKey) {
			  return localStorage.getItem('cartContents_' + visitorIdKey);
			}
	
			function getVisitorIdKey() {
			  var visitorIdKey;
				
				if(localStorage.visitorId == 'undefined' || localStorage.visitorId == null) {
				  window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
					visitorIdKey = localStorage.visitorId
					setVisitorIdText(visitorIdKey);
				}
				
				return visitorIdKey;
			}
	
			function setVisitorIdText(text) {
				$('#visitor-id').text(text);
			}
			
			function setSearchHistoryTitle(isHistory) {
				var hasHistoryTitle = 'Your current search history',
					  noHistoryTitle = 'You have no search history';
						
		    $('#search-history-title').text(isHistory ? hasHistoryTitle : noHistoryTitle);
			}
			
			function setCartContentsTitle(hasContents) {
				var hasContentsTitle = 'Your cart contains',
					  noContentsTitle = 'Your cart is empty';
						
		    $('#cart-contents-title').text(hasContents ? hasContentsTitle : noContentsTitle);
			}
			
			function addToCart(item) {
				var visitorIdKey = getVisitorIdKey(), lsCartContents;
				
				lsCartContents = localStorage.getItem('cartContents_' + visitorIdKey);
				
				if(lsCartContents == null || lsCartContents == '') {
					lsCartContents = item;
				} else {
					lsCartContents = lsCartContents + ',' + item;
				}
				
				localStorage.setItem('cartContents_' + visitorIdKey, lsCartContents);	
				
				$('ul.cart-contents').append('<li>' + item + '</li>');
				
				setCartContentsTitle(true);
			}
			
		  function addSearchItem() {
				var visitorIdKey = getVisitorIdKey(), lsSerchHistory, searchValue = $('#search-value').val();

				if(searchValue == '')
					return;
				
				lsSerchHistory = localStorage.getItem('searchHistory_' + visitorIdKey);
				
				if(lsSerchHistory == null || lsSerchHistory == '') {
					lsSerchHistory = searchValue;
				} else {
					lsSerchHistory = lsSerchHistory + ',' + searchValue;
				}
				
				localStorage.setItem('searchHistory_' + visitorIdKey, lsSerchHistory);	
				
				$('ul.search-history').append('<li>' + searchValue + '</li>');
				
				$('#search-value').val('');
				
				setSearchHistoryTitle(true);	
			}
			
			function clearLSSearchHistory() {
			  var visitorIdKey = localStorage.visitorId;
				if(visitorIdKey != null) {
				  localStorage.removeItem('searchHistory_' + visitorIdKey);
				}
				setSearchHistoryTitle(false);
				$('ul.search-history').empty();;
			}
			
			function clearLsVisitorId() {
			  localStorage.clear();
				setVisitorIdText('not set');
				setSearchHistoryTitle(false);
				setCartContentsTitle(false);
			}
			
			function clearLSCartContents() {
			  var visitorIdKey = localStorage.visitorId;
				if(visitorIdKey != null) {
				  localStorage.removeItem('cartContents_' + visitorIdKey);
				}
				setCartContentsTitle(false);
				$('ul.cart-contents').empty();;
			}
			
			$(document).ready(function(){
				var visitorIdKey = getVisitorIdKey(),
				    searchHistory, searchHistoryItems,
						cartContents, cartContentsItems;
								
			  searchHistory = getSearchHistory(visitorIdKey);
				
				if(searchHistory != null && searchHistory != '') {
					searchHistoryItems = searchHistory.split(",");
					searchHistoryItems.forEach(function(item){
						$('ul.search-history').append('<li>' + item + '</li>');		
					});
					isSearchHistory = true;
				} else {
					isSearchHistory = false;
				}
				
				cartContents = getCartContents(visitorIdKey);
				
				if(cartContents != null && cartContents != '') {
					cartContentsItems = cartContents.split(",");
					cartContentsItems.forEach(function(item){
						$('ul.cart-contents').append('<li>' + item + '</li>');		
					});
					isCartContents = true;
				} else {
					isCartContents = false;
				}

				setSearchHistoryTitle(isSearchHistory);	
				setCartContentsTitle(isCartContents);
      });
		</script>
  </head>

  <body>
	  <div class="header">
			<a class="brand">
				<img src="oracle_logo.svg">
				<span>Fake Commerce Cloud Site</span>
			</a>
		</div>

	  <div class="visitor-id-panel">
		  <p>VisitorId: <span class="strong" id="visitor-id">not set</span></p>
		</div>
		
		<hr />
		
		<div class="search-panel">
      <p>
			  <input id="search-value" type="text" placeholder="Search..."></input>
			  <button type="button" onclick="addSearchItem()">Search</button>
		  </p>
		</div>
		
		<hr />
		
		<div class="product-panel">
			<table border="0" style="text-align: center; width: 50%; margin: auto;">
				<tr>
					<td><img src="sw4.jpg" height="30%" width="30%" /></td>
					<td><img src="sw6.jpg" height="30%" width="30%" /></td>
					<td><img src="lotr.jpg" height="30%" width="30%" /></td>
				</tr>
				<tr>
					<td>Star Wars Episode 4</td>
					<td>Star Wars Episode 6</td>
					<td>Lord Of the Rings</td>
				</tr>
				<tr>
					<td><button onclick="addToCart('Star Wars Episode 4')">Add to Cart</button></td>
					<td><button onclick="addToCart('Star Wars Episode 6')">Add to Cart</button></td>
					<td><button onclick="addToCart('Lord of the Rings')">Add to Cart</button></td>
				</tr>
			</table>
		</div>
		
		<hr />
		<div style="float: left; width: 100%">
			<div class="search-history-panel" style="float: left; width: 50%">
				<h4 id="search-history-title"></h4>
				<ul class="search-history"></ul>
			</div>

			<div class="cart-contents-panel" style="float: left; width: 50%">
				<h4 id="cart-contents-title"></h4>
				<ul class="cart-contents"></ul>
			</div>
		</div>
		
		<hr />
		
		<div>
		  <p>
		    <button type="button" onclick="clearLSSearchHistory()">Clear Search History</button>
				<button type="button" onclick="clearLSCartContents()">Clear Cart Contents</button>
		    <button type="button" onclick="clearLsVisitorId()">Clear Visitor ID</button>
	    </p>
		</div>
  <body>
</html>
