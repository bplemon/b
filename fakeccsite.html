<html>
  <head>
    <title>Fake Cloud Commerce Site</title>
		<script type='text/javascript' src="https://cloud-commerce-visit.oracleoutsourcing.com/Visit/js/oracleunifiedvisit.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="https://ccexperimentsstatic.oracleoutsourcing.com/js/atgsvcs.js"></script>
		<link href="style.css" rel="stylesheet" />
		
    <script type="text/javascript">
			window.OracleUnifiedVisit =
			{
				accountId: '0000000000001',
				host: 'https://cloud-commerce-visit.oracleoutsourcing.com',
				handle: function()
				{
					window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
				}
			};
		</script>
		
		<script>
		
			function getSearchHistory(visitorIdKey) {
			  return localStorage.getItem('searchHistory_' + visitorIdKey);
			}
		
		  function addSearchItem() {
				var visitorIdKey = localStorage.visitorId, searchValue = $('#search-value').val();

				if(searchValue == '')
					return;
				
				if(visitorIdKey == null) {
				  window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
					visitorIdKey = localStorage.visitorId;
				}

				lsSerchHistory = localStorage.getItem('searchHistory_' + visitorIdKey);
				
				if(lsSerchHistory == null || lsSerchHistory == '') {
					lsSerchHistory = searchValue;
				} else {
					lsSerchHistory = lsSerchHistory + ',' + searchValue;
				}
				
				localStorage.setItem('searchHistory_' + visitorIdKey, lsSerchHistory);	
				
				$('ul.search-history').append('<li>' + searchValue + '</li>');
				
				$('#search-value').val('');
			}
			
			function clearLSSearchHistory() {
			  var visitorIdKey = localStorage.visitorId;
				if(visitorIdKey != null) {
				  localStorage.removeItem('searchHistory_' + visitorIdKey);
				}
			}
			
			function clearLsVisitorId() {
			  localStorage.clear();
			}
			
			$(document).ready(function(){
				var visitorIdKey = localStorage.visitorId;

				if(visitorIdKey == null) {
				  window.ATGSvcs && ATGSvcs.visitIDsLoaded();
					localStorage.visitorId = window.OracleUnifiedVisit.visitorId();
					localStorage.visitId = window.OracleUnifiedVisit.visitId();
					visitorIdKey = localStorage.visitorId;
				}
				
			  var searchHistory = getSearchHistory(visitorIdKey), items;
				
				items = searchHistory.split(",");
				items.forEach(function(item){
					$('ul.search-history').append('<li>' + item + '</li>');		
				});
				
				
      });
		</script>
  </head>

  <body>
	  <div class="header">
			<a class="brand">
				<img src="oracle_logo.svg">
				<span>Fake Commerce Cloud Site</span>
			</a>
		</div>

    <p>
			<input id="search-value" type="text" placeholder="Search..."></input>
			<button type="button" onclick="addSearchItem()">Search</button>
		</p>
		
		<hr />
		<h4>Search History</h4>
		<ul class="search-history"></ul>
  
		<hr />
		<p>
		  <button type="button" onclick="clearLSSearchHistory()">Clear Search History</button>
		  <button type="button" onclick="clearLsVisitorId()">Clear Visitor ID</button>
	  </p>

  <body>
</html>
